<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚≠ê Ammu ‚ù§Ô∏è Nani ‚≠ê</title>
<style>
body{font-family:Arial,sans-serif;background:#ffe6f0;display:flex;flex-direction:column;align-items:center;padding:20px;}
h1{color:#ff3366;text-align:center;}
.card{background:white;padding:20px;margin:10px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.2);width:300px;text-align:center;}
button{background-color:#ff4d6d;color:white;font-weight:bold;font-size:16px;padding:10px 20px;border:none;border-radius:8px;margin:5px;cursor:pointer;}
button.remove{background-color:#ffa3b1;}
#loginBox,#app{width:350px;}
.hidden{display:none;}
#chatBox{height:150px;overflow:auto;background:#f0f0f0;padding:10px;border-radius:10px;text-align:left;margin-bottom:10px;}
input{padding:8px;width:80%;border-radius:5px;border:1px solid #ccc;margin-bottom:5px;}
</style>
</head>
<body>

<h1>‚≠ê Ammu ‚ù§Ô∏è Nani ‚≠ê</h1>

<!-- LOGIN -->
<div id="loginBox" class="card">
  <h2>Login</h2>
  <input id="username" placeholder="Ammu or Nani"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
  <p id="error" style="color:red;"></p>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <h3 id="welcome"></h3>
  <button onclick="logout()">Logout</button>

  <!-- Ammu Card -->
  <div id="ammuCard" class="card">
    <h2>Ammu</h2>
    <h3 id="ammuStars">0</h3>
    <button id="ammuAdd" onclick="changeStar('Ammu',1)">+ Star</button>
    <button id="ammuRemove" class="remove" onclick="changeStar('Ammu',-1)">- Star</button>
  </div>

  <!-- Nani Card -->
  <div id="naniCard" class="card">
    <h2>Nani</h2>
    <h3 id="naniStars">0</h3>
    <button id="naniAdd" onclick="changeStar('Nani',1)">+ Star</button>
    <button id="naniRemove" class="remove" onclick="changeStar('Nani',-1)">- Star</button>
  </div>

  <!-- Private Messages -->
  <div class="card">
    <h2>üíå Private Messages</h2>
    <div id="chatBox"></div>
    <input id="msgInput" placeholder="Type message...">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// ================== SUPABASE ==================
const supabase = window.supabase.createClient(
  "https://dpnoooewtbjkzxcugkrd.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRwbm9vb2V3dGJqa3p4Y3Vna3JkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2ODYxODMsImV4cCI6MjA4NzI2MjE4M30.ugDUdtpEArQ38DH3mulCKuDTV4scWtCKtZXkQ-CzFnI"
);

// ================== LOGIN ==================
const USERS = { Ammu:"ammu123", Nani:"nani123" };
let currentUser = "";

function login(){
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();
  const error = document.getElementById('error');
  if(USERS[user] && USERS[user]===pass){
    currentUser=user;
    document.getElementById('loginBox').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    document.getElementById('welcome').innerText=`Welcome ${user}!`;
    loadStars();
    loadMessages();
    error.innerText="";
  } else {
    error.innerText="Invalid username or password!";
  }
}

function logout(){
  currentUser="";
  document.getElementById('app').classList.add('hidden');
  document.getElementById('loginBox').classList.remove('hidden');
  document.getElementById('username').value="";
  document.getElementById('password').value="";
}

// ================== STARS ==================
let stars={Ammu:0,Nani:0};

async function loadStars(){
  const { data, error } = await supabase.from('Star').select();
  if(!error && data.length){
    data.forEach(row=>{ stars[row.person]=row.count; });
    updateStarsUI();
  }
  lockButtons();
}

function updateStarsUI(){
  document.getElementById('ammuStars').innerText = stars['Ammu'];
  document.getElementById('naniStars').innerText = stars['Nani'];
}

function changeStar(person,delta){
  if((currentUser==='Ammu' && person==='Ammu') || (currentUser==='Nani' && person==='Nani')){
    alert("You can't change your own stars!");
    return;
  }
  stars[person]+=delta;
  if(stars[person]<0) stars[person]=0;
  updateStarsUI();
  saveStars(person);
}

async function saveStars(person){
  await supabase.from('Star').upsert({ person:person, count:stars[person] });
}

function lockButtons(){
  document.getElementById('ammuAdd').disabled=currentUser==='Ammu';
  document.getElementById('ammuRemove').disabled=currentUser==='Ammu';
  document.getElementById('naniAdd').disabled=currentUser==='Nani';
  document.getElementById('naniRemove').disabled=currentUser==='Nani';
}

// ================== MESSAGES ==================
async function loadMessages(){
  const { data, error } = await supabase.from('Messages').select().order('timestamp',{ascending:true});
  if(!error && data.length){
    const box = document.getElementById('chatBox');
    box.innerHTML = data.map(row=>`${row.sender}: ${row.message}`).join('<br>');
  }
}

async function sendMessage(){
  const msgInput=document.getElementById('msgInput');
  if(msgInput.value.trim()==="") return;
  const message = msgInput.value.trim();
  // Save to Supabase
  await supabase.from('Messages').insert([{ sender: currentUser, message: message }]);
  msgInput.value="";
  loadMessages();
}
</script>
</body>
</html>
